<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>ğŸ”Œ WebSocket ì±„íŒ… í…ŒìŠ¤íŠ¸</h1>
<div id="status" style="font-size: 20px; margin: 20px;">ì—°ê²° ì¤‘...</div>

<div style="margin: 20px;">
    <input type="text" id="messageInput" placeholder="ë©”ì‹œì§€ ì…ë ¥" style="width: 300px;">
    <button onclick="sendMessage()">ì „ì†¡</button>
</div>

<div id="messages" style="border: 1px solid #ccc; padding: 10px; margin: 20px; height: 300px; overflow-y: auto;"></div>

<script>
    // PowerShellì—ì„œ ë°›ì€ í† í°ì„ ì—¬ê¸° ë¶™ì—¬ë„£ê¸°!
    const token = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiI2IiwiZW1haWwiOiJ0ZXN0MkB0ZXN0LmNvbSIsInJvbGUiOiJVU0VSIiwiaWF0IjoxNzcwMzUwMDM2LCJleHAiOjE3NzA0MzY0MzZ9.UrCHB-LgwSE-x6anFpZkV1on7E7JHSoljf3fqJObgrI\n';

    let stompClient = null;

    const socket = new SockJS('http://13.218.231.14:8080/ws/chat');
    stompClient = Stomp.over(socket);

    stompClient.connect(
        { Authorization: 'Bearer ' + token },
        (frame) => {
            document.getElementById('status').innerHTML = 'âœ… <span style="color: green;">ì—°ê²° ì„±ê³µ!</span>';
            console.log('âœ… ì—°ê²°ë¨:', frame);

            // ì±„íŒ… êµ¬ë…
            stompClient.subscribe('/topic/chat', (message) => {
                console.log('ğŸ“© ë©”ì‹œì§€ ìˆ˜ì‹ :', message.body);
                const div = document.getElementById('messages');
                div.innerHTML += '<p>ğŸ“© ' + message.body + '</p>';
                div.scrollTop = div.scrollHeight;
            });
        },
        (error) => {
            document.getElementById('status').innerHTML = 'âŒ <span style="color: red;">ì—°ê²° ì‹¤íŒ¨</span>';
            console.error('âŒ ì—ëŸ¬:', error);
        }
    );

    function sendMessage() {
        const input = document.getElementById('messageInput');
        const message = input.value;

        if (message && stompClient) {
            stompClient.send('/app/chat', {}, JSON.stringify({
                message: message
            }));
            input.value = '';
        }
    }
</script>
</body>
</html>